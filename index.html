<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expat Portfolio Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .feature-card h3 {
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .currency-converter {
            background: rgba(255, 255, 255, 0.15);
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 16px;
        }

        button {
            width: 100%;
            padding: 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }

        button:hover {
            background: #45a049;
        }

        .result {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 1.1em;
        }

        .tax-result {
            line-height: 1.6;
        }

        .tax-result .highlight {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }

        .tax-result .breakdown {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .market-hours {
            background: rgba(255, 255, 255, 0.1);
        }

        .market-status {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }

        .status-open {
            color: #4CAF50;
        }

        .status-closed {
            color: #f44336;
        }

        .coming-soon {
            text-align: center;
            font-style: italic;
            opacity: 0.8;
        }

        .warning {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid rgba(255, 193, 7, 0.5);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .info-box {
            background: rgba(33, 150, 243, 0.2);
            border: 1px solid rgba(33, 150, 243, 0.5);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 0.9em;
        }

        /* Advertisement Section */
        .ads-section {
            margin-top: 60px;
            padding: 40px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .ads-section h3 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.8em;
            opacity: 0.9;
        }

        .ad-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .ad-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            transition: transform 0.3s, background 0.3s;
        }

        .ad-box:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }

        .ad-box h4 {
            margin-bottom: 10px;
            font-size: 1.2em;
            color: #fff;
        }

        .ad-box p {
            margin-bottom: 15px;
            opacity: 0.9;
            line-height: 1.4;
        }

        .ad-button {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            width: auto;
        }

        .ad-button:hover {
            background: linear-gradient(45deg, #ff5252, #ff7979);
            transform: scale(1.05);
        }

        .ad-disclaimer {
            text-align: center;
            margin-top: 20px;
            opacity: 0.7;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŒ Expat Portfolio Tracker</h1>
            <p class="subtitle">Track your international investments across multiple currencies</p>
        </header>

        <div class="features">
            <!-- Currency Converter -->
            <div class="feature-card currency-converter">
                <h3>ğŸ’± Currency Converter</h3>
                <div class="input-group">
                    <label for="amount">Amount:</label>
                    <input type="number" id="amount" placeholder="Enter amount" value="1000">
                </div>
                <div class="input-group">
                    <label for="fromCurrency">From:</label>
                    <select id="fromCurrency">
                        <option value="SGD">ğŸ‡¸ğŸ‡¬ SGD - Singapore Dollar</option>
                        <option value="USD">ğŸ‡ºğŸ‡¸ USD - US Dollar</option>
                        <option value="EUR">ğŸ‡ªğŸ‡º EUR - Euro</option>
                        <option value="GBP">ğŸ‡¬ğŸ‡§ GBP - British Pound</option>
                        <option value="JPY">ğŸ‡¯ğŸ‡µ JPY - Japanese Yen</option>
                        <option value="CAD">ğŸ‡¨ğŸ‡¦ CAD - Canadian Dollar</option>
                        <option value="AUD">ğŸ‡¦ğŸ‡º AUD - Australian Dollar</option>
                        <option value="HKD">ğŸ‡­ğŸ‡° HKD - Hong Kong Dollar</option>
                        <option value="MYR">ğŸ‡²ğŸ‡¾ MYR - Malaysian Ringgit</option>
                        <option value="CHF">ğŸ‡¨ğŸ‡­ CHF - Swiss Franc</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="toCurrency">To:</label>
                    <select id="toCurrency">
                        <option value="USD">ğŸ‡ºğŸ‡¸ USD - US Dollar</option>
                        <option value="SGD">ğŸ‡¸ğŸ‡¬ SGD - Singapore Dollar</option>
                        <option value="EUR">ğŸ‡ªğŸ‡º EUR - Euro</option>
                        <option value="GBP">ğŸ‡¬ğŸ‡§ GBP - British Pound</option>
                        <option value="JPY">ğŸ‡¯ğŸ‡µ JPY - Japanese Yen</option>
                        <option value="CAD">ğŸ‡¨ğŸ‡¦ CAD - Canadian Dollar</option>
                        <option value="AUD">ğŸ‡¦ğŸ‡º AUD - Australian Dollar</option>
                        <option value="HKD">ğŸ‡­ğŸ‡° HKD - Hong Kong Dollar</option>
                        <option value="MYR">ğŸ‡²ğŸ‡¾ MYR - Malaysian Ringgit</option>
                        <option value="CHF">ğŸ‡¨ğŸ‡­ CHF - Swiss Franc</option>
                    </select>
                </div>
                <button onclick="convertCurrency()">Convert</button>
                <div id="conversionResult" class="result" style="display: none;"></div>
            </div>

            <!-- Market Hours -->
            <div class="feature-card market-hours">
                <h3>ğŸ• Global Market Hours</h3>
                <div id="marketHours">
                    <div class="market-status">
                        <span>ğŸ‡ºğŸ‡¸ NYSE (New York)</span>
                        <span id="nyseStatus" class="status-closed">Closed</span>
                    </div>
                    <div class="market-status">
                        <span>ğŸ‡¬ğŸ‡§ LSE (London)</span>
                        <span id="lseStatus" class="status-closed">Closed</span>
                    </div>
                    <div class="market-status">
                        <span>ğŸ‡¯ğŸ‡µ TSE (Tokyo)</span>
                        <span id="tseStatus" class="status-closed">Closed</span>
                    </div>
                    <div class="market-status">
                        <span>ğŸ‡¦ğŸ‡º ASX (Sydney)</span>
                        <span id="asxStatus" class="status-closed">Closed</span>
                    </div>
                </div>
            </div>

            <!-- Portfolio Tracker -->
            <div class="feature-card">
                <h3>ğŸ“Š Portfolio Tracker</h3>
                <p class="coming-soon">Coming soon! Add your stocks and track performance across currencies.</p>
            </div>

            <!-- Enhanced Tax Calculator -->
            <div class="feature-card">
                <h3>ğŸ’¼ Advanced Tax Calculator</h3>
                
                <div class="input-group">
                    <label for="taxCountry">Tax Residence:</label>
                    <select id="taxCountry">
                        <option value="SG">ğŸ‡¸ğŸ‡¬ Singapore</option>
                        <option value="US">ğŸ‡ºğŸ‡¸ United States</option>
                        <option value="UK">ğŸ‡¬ğŸ‡§ United Kingdom</option>
                        <option value="AU">ğŸ‡¦ğŸ‡º Australia</option>
                        <option value="CA">ğŸ‡¨ğŸ‡¦ Canada</option>
                        <option value="DE">ğŸ‡©ğŸ‡ª Germany</option>
                        <option value="FR">ğŸ‡«ğŸ‡· France</option>
                        <option value="NL">ğŸ‡³ğŸ‡± Netherlands</option>
                        <option value="CH">ğŸ‡¨ğŸ‡­ Switzerland</option>
                        <option value="JP">ğŸ‡¯ğŸ‡µ Japan</option>
                        <option value="HK">ğŸ‡­ğŸ‡° Hong Kong</option>
                        <option value="AE">ğŸ‡¦ğŸ‡ª UAE</option>
                        <option value="NZ">ğŸ‡³ğŸ‡¿ New Zealand</option>
                        <option value="IN">ğŸ‡®ğŸ‡³ India</option>
                        <option value="MY">ğŸ‡²ğŸ‡¾ Malaysia</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="investmentCountry">Investment Country:</label>
                    <select id="investmentCountry">
                        <option value="US">ğŸ‡ºğŸ‡¸ United States</option>
                        <option value="SG">ğŸ‡¸ğŸ‡¬ Singapore</option>
                        <option value="UK">ğŸ‡¬ğŸ‡§ United Kingdom</option>
                        <option value="AU">ğŸ‡¦ğŸ‡º Australia</option>
                        <option value="CA">ğŸ‡¨ğŸ‡¦ Canada</option>
                        <option value="DE">ğŸ‡©ğŸ‡ª Germany</option>
                        <option value="FR">ğŸ‡«ğŸ‡· France</option>
                        <option value="JP">ğŸ‡¯ğŸ‡µ Japan</option>
                        <option value="HK">ğŸ‡­ğŸ‡° Hong Kong</option>
                        <option value="NL">ğŸ‡³ğŸ‡± Netherlands</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="investmentType">Investment Type:</label>
                    <select id="investmentType">
                        <option value="stocks">Stocks/Shares</option>
                        <option value="dividends">Dividends</option>
                        <option value="bonds">Bonds/Fixed Income</option>
                        <option value="reit">REITs</option>
                        <option value="etf">ETFs</option>
                    </select>
                </div>

                <div class="input-row">
                    <div class="input-group">
                        <label for="purchasePrice">Purchase Price:</label>
                        <input type="number" id="purchasePrice" placeholder="Original cost" step="0.01">
                    </div>
                    <div class="input-group">
                        <label for="salePrice">Sale Price:</label>
                        <input type="number" id="salePrice" placeholder="Sale proceeds" step="0.01">
                    </div>
                </div>

                <div class="input-group">
                    <label for="currency">Currency:</label>
                    <select id="currency">
                        <option value="SGD">ğŸ‡¸ğŸ‡¬ SGD</option>
                        <option value="USD">ğŸ‡ºğŸ‡¸ USD</option>
                        <option value="EUR">ğŸ‡ªğŸ‡º EUR</option>
                        <option value="GBP">ğŸ‡¬ğŸ‡§ GBP</option>
                        <option value="JPY">ğŸ‡¯ğŸ‡µ JPY</option>
                        <option value="CAD">ğŸ‡¨ğŸ‡¦ CAD</option>
                        <option value="AUD">ğŸ‡¦ğŸ‡º AUD</option>
                        <option value="HKD">ğŸ‡­ğŸ‡° HKD</option>
                    </select>
                </div>

                <div class="input-row">
                    <div class="input-group">
                        <label for="holdingPeriod">Holding Period (months):</label>
                        <input type="number" id="holdingPeriod" placeholder="Duration held">
                    </div>
                    <div class="input-group">
                        <label for="annualIncome">Annual Income:</label>
                        <input type="number" id="annualIncome" placeholder="For tax bracket">
                    </div>
                </div>

                <div class="input-group">
                    <label for="dividendAmount">Dividend Income (if any):</label>
                    <input type="number" id="dividendAmount" placeholder="Total dividends received" step="0.01">
                </div>

                <button onclick="calculateTax()">Calculate Tax</button>
                <div id="taxResult" class="result tax-result" style="display: none;"></div>
            </div>
        </div>

        <!-- Advertisement Section -->
        <div class="ads-section">
            <h3>ğŸ“¢ Sponsored</h3>
            <div class="ad-container">
                <div class="ad-box">
                    <h4>ğŸ¦ Best International Brokers</h4>
                    <p>Compare fees and features for global investing</p>
                    <button class="ad-button">Learn More</button>
                </div>
                <div class="ad-box">
                    <h4>ğŸ’³ Multi-Currency Cards</h4>
                    <p>Save on forex fees with expat-friendly cards</p>
                    <button class="ad-button">Get Started</button>
                </div>
                <div class="ad-box">
                    <h4>ğŸ“Š Tax Advisory Services</h4>
                    <p>Expert tax help for international investors</p>
                    <button class="ad-button">Book Consultation</button>
                </div>
            </div>
            <div class="ad-disclaimer">
                <small>* This is a demo advertisement section. Real ads would generate revenue through Google AdSense, affiliate partnerships, or sponsored content.</small>
            </div>
        </div>
    </div>

    <script>
        // Currency conversion function
        async function convertCurrency() {
            const amount = document.getElementById('amount').value;
            const fromCurrency = document.getElementById('fromCurrency').value;
            const toCurrency = document.getElementById('toCurrency').value;
            const resultDiv = document.getElementById('conversionResult');

            if (!amount || amount <= 0) {
                alert('Please enter a valid amount');
                return;
            }

            if (fromCurrency === toCurrency) {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `${amount} ${fromCurrency} = ${amount} ${toCurrency}`;
                return;
            }

            try {
                const response = await fetch(`https://api.exchangerate-api.com/v4/latest/${fromCurrency}`);
                const data = await response.json();
                
                const rate = data.rates[toCurrency];
                const convertedAmount = (amount * rate).toFixed(2);
                
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `${amount} ${fromCurrency} = ${convertedAmount} ${toCurrency}<br><small>Rate: 1 ${fromCurrency} = ${rate.toFixed(4)} ${toCurrency}</small>`;
            } catch (error) {
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = 'Error fetching exchange rates. Please try again.';
            }
        }

        // Market hours checker
        function updateMarketHours() {
            const now = new Date();
            const utcTime = now.getTime() + (now.getTimezoneOffset() * 60000);
            
            const markets = {
                nyse: { open: 14.5, close: 21, name: 'nyseStatus' },
                lse: { open: 8, close: 16.5, name: 'lseStatus' },
                tse: { open: 0, close: 6, name: 'tseStatus' },
                asx: { open: 23, close: 6, name: 'asxStatus' }
            };

            const currentUTCHour = new Date(utcTime).getUTCHours() + (new Date(utcTime).getUTCMinutes() / 60);
            
            Object.keys(markets).forEach(market => {
                const marketInfo = markets[market];
                const statusElement = document.getElementById(marketInfo.name);
                
                let isOpen = false;
                if (marketInfo.open < marketInfo.close) {
                    isOpen = currentUTCHour >= marketInfo.open && currentUTCHour < marketInfo.close;
                } else {
                    isOpen = currentUTCHour >= marketInfo.open || currentUTCHour < marketInfo.close;
                }
                
                statusElement.textContent = isOpen ? 'Open' : 'Closed';
                statusElement.className = isOpen ? 'status-open' : 'status-closed';
            });
        }

        updateMarketHours();
        setInterval(updateMarketHours, 60000);

        // Enhanced tax calculation function
        function calculateTax() {
            const country = document.getElementById('taxCountry').value;
            const investmentCountry = document.getElementById('investmentCountry').value;
            const investmentType = document.getElementById('investmentType').value;
            const purchasePrice = parseFloat(document.getElementById('purchasePrice').value);
            const salePrice = parseFloat(document.getElementById('salePrice').value);
            const currency = document.getElementById('currency').value;
            const holdingPeriod = parseInt(document.getElementById('holdingPeriod').value);
            const annualIncome = parseFloat(document.getElementById('annualIncome').value) || 0;
            const dividendAmount = parseFloat(document.getElementById('dividendAmount').value) || 0;
            const resultDiv = document.getElementById('taxResult');

            if (!purchasePrice || !salePrice || !holdingPeriod) {
                alert('Please enter purchase price, sale price, and holding period');
                return;
            }

            const capitalGain = salePrice - purchasePrice;
            const isLongTerm = holdingPeriod >= 12;

            // Withholding tax rates by investment country
            const withholdingRates = {
                'US': { stocks: 0, dividends: 0.30, bonds: 0.30 },
                'UK': { stocks: 0, dividends: 0.20, bonds: 0.20 },
                'AU': { stocks: 0, dividends: 0.30, bonds: 0.10 },
                'CA': { stocks: 0, dividends: 0.25, bonds: 0.25 },
                'DE': { stocks: 0, dividends: 0.26, bonds: 0.26 },
                'FR': { stocks: 0, dividends: 0.30, bonds: 0.30 },
                'JP': { stocks: 0, dividends: 0.20, bonds: 0.20 },
                'SG': { stocks: 0, dividends: 0, bonds: 0 },
                'HK': { stocks: 0, dividends: 0, bonds: 0 },
                'NL': { stocks: 0, dividends: 0.15, bonds: 0.15 }
            };

            // Tax rates by residence country
            const taxRates = {
                'SG': { 
                    rate: 0, 
                    info: 'Singapore: No capital gains tax for individual investors',
                    dividendRate: 0,
                    dividendInfo: 'Singapore: No tax on foreign dividends (if tax paid abroad)'
                },
                'US': { 
                    rate: isLongTerm ? 0.15 : 0.22, 
                    info: isLongTerm ? 'US: Long-term capital gains (15%)' : 'US: Short-term capital gains (22%)',
                    dividendRate: 0.15,
                    dividendInfo: 'US: Qualified dividends (15%)'
                },
                'UK': { 
                    rate: annualIncome > 50000 ? 0.20 : 0.10, 
                    info: `UK: Capital gains tax (${annualIncome > 50000 ? '20%' : '10%'})`,
                    dividendRate: annualIncome > 50000 ? 0.3825 : 0.075,
                    dividendInfo: `UK: Dividend tax (${annualIncome > 50000 ? '38.25%' : '7.5%'})`
                },
                'AU': { 
                    rate: isLongTerm ? 0.225 : 0.45, 
                    info: isLongTerm ? 'Australia: CGT with 50% discount (22.5%)' : 'Australia: Full CGT rate (45%)',
                    dividendRate: 0.45,
                    dividendInfo: 'Australia: Dividend tax (45%)'
                },
                'CA': { 
                    rate: 0.25, 
                    info: 'Canada: 50% of capital gains taxable (25%)',
                    dividendRate: 0.25,
                    dividendInfo: 'Canada: Dividend tax (25%)'
                },
                'DE': { 
                    rate: 0.25, 
                    info: 'Germany: Capital gains tax (25%)',
                    dividendRate: 0.25,
                    dividendInfo: 'Germany: Dividend tax (25%)'
                },
                'FR': { 
                    rate: 0.30, 
                    info: 'France: Capital gains tax (30%)',
                    dividendRate: 0.30,
                    dividendInfo: 'France: Dividend tax (30%)'
                },
                'NL': { 
                    rate: 0.31, 
                    info: 'Netherlands: Box 3 tax (31%)',
                    dividendRate: 0.31,
                    dividendInfo: 'Netherlands: Dividend tax (31%)'
                },
                'CH': { 
                    rate: 0, 
                    info: 'Switzerland: No capital gains tax for private investors',
                    dividendRate: 0.35,
                    dividendInfo: 'Switzerland: Dividend tax (35%)'
                },
                'JP': { 
                    rate: 0.20, 
                    info: 'Japan: Capital gains tax (20%)',
                    dividendRate: 0.20,
                    dividendInfo: 'Japan: Dividend tax (20%)'
                },
                'HK': { 
                    rate: 0, 
                    info: 'Hong Kong: No capital gains tax',
                    dividendRate: 0,
                    dividendInfo: 'Hong Kong: No dividend tax'
                },
                'AE': { 
                    rate: 0, 
                    info: 'UAE: No capital gains tax',
                    dividendRate: 0,
                    dividendInfo: 'UAE: No dividend tax'
                },
                'NZ': { 
                    rate: 0, 
                    info: 'New Zealand: No capital gains tax for most investors',
                    dividendRate: 0.33,
                    dividendInfo: 'New Zealand: Dividend tax (33%)'
                },
                'IN': { 
                    rate: isLongTerm ? 0.10 : 0.15, 
                    info: isLongTerm ? 'India: Long-term CGT (10%)' : 'India: Short-term CGT (15%)',
                    dividendRate: 0.10,
                    dividendInfo: 'India: Dividend tax (10%)'
                },
                'MY': { 
                    rate: 0, 
                    info: 'Malaysia: No capital gains tax for individuals',
                    dividendRate: 0,
                    dividendInfo: 'Malaysia: No dividend tax'
                }
            };

            const countryTax = taxRates[country] || { 
                rate: 0.20, 
                info: 'Default: 20% capital gains tax',
                dividendRate: 0.20,
                dividendInfo: 'Default: 20% dividend tax'
            };

            const withholdingInfo = withholdingRates[investmentCountry] || { stocks: 0, dividends: 0.30, bonds: 0.30 };

            let resultHTML = `
                <div class="breakdown">
                    <h4>ğŸ“Š Investment Summary</h4>
                    <strong>Investment Country:</strong> ${investmentCountry}<br>
                    <strong>Tax Residence:</strong> ${country}<br>
                    <strong>Investment Type:</strong> ${investmentType}<br>
                    <strong>Currency:</strong> ${currency}<br>
                    <strong>Holding Period:</strong> ${holdingPeriod} months ${isLongTerm ? '(Long-term)' : '(Short-term)'}<br>
                    <strong>Purchase Price:</strong> ${currency} ${purchasePrice.toLocaleString()}<br>
                    <strong>Sale Price:</strong> ${currency} ${salePrice.toLocaleString()}<br>
                    <strong>Capital Gain/Loss:</strong> ${currency} ${capitalGain.toLocaleString()}
                </div>
            `;

            if (capitalGain > 0) {
                const capitalGainsTax = capitalGain * countryTax.rate;
                const withholdingTaxRate = withholdingInfo.stocks || 0;
                const withholdingAmount = capitalGain * withholdingTaxRate;
                const netCapitalGainsTax = Math.max(0, capitalGainsTax - withholdingAmount);

                resultHTML += `
                    <div class="breakdown">
                        <h4>ğŸ’° Capital Gains Tax</h4>
                        <strong>${countryTax.info}</strong><br>
                        Gross Tax: ${currency} ${capitalGainsTax.toLocaleString()}<br>
                        Withholding Tax: ${currency} ${withholdingAmount.toLocaleString()}<br>
                        <div class="highlight">Net Capital Gains Tax: ${currency} ${netCapitalGainsTax.toLocaleString()}</div>
                    </div>
                `;
            } else {
                resultHTML += `
                    <div class="breakdown">
                        <h4>ğŸ’° Capital Gains Tax</h4>
                        <strong>${countryTax.info}</strong><br>
                        Capital Loss: ${currency} ${Math.abs(capitalGain).toLocaleString()}<br>
                        <div class="highlight">No tax due on losses</div>
                        <small>Losses may be deductible against future gains</small>
                    </div>
                `;
            }

            if (dividendAmount > 0) {
                const dividendTax = dividendAmount * countryTax.dividendRate;
                const dividendWithholdingRate = withholdingInfo.dividends || 0;
                const dividendWithholdingAmount = dividendAmount * dividendWithholdingRate;
                const netDividendTax = Math.max(0, dividendTax - dividendWithholdingAmount);

                resultHTML += `
                    <div class="breakdown">
                        <h4>ğŸ“ˆ Dividend Tax</h4>
                        <strong>${countryTax.dividendInfo}</strong><br>
                        Dividend Income: ${currency} ${dividendAmount.toLocaleString()}<br>
                        Gross Tax: ${currency} ${dividendTax.toLocaleString()}<br>
                        Withholding Tax: ${currency} ${dividendWithholdingAmount.toLocaleString()}<br>
                        <div class="highlight">Net Dividend Tax: ${currency} ${netDividendTax.toLocaleString()}</div>
                    </div>
                `;
            }

            const totalTax = (capitalGain > 0 ? Math.max(0, capitalGain * countryTax.rate - capitalGain * (withholdingInfo.stocks || 0)) : 0) + 
                            (dividendAmount > 0 ? Math.max(0, dividendAmount * countryTax.dividendRate - dividendAmount * (withholdingInfo.dividends || 0)) : 0);

            resultHTML += `
                <div class="highlight">
                    <h4>ğŸ’¼ Total Tax Summary</h4>
                    <strong>Total Tax Due: ${currency} ${totalTax.toLocaleString()}</strong><br>
                    <strong>Net Proceeds: ${currency} ${(salePrice + dividendAmount - totalTax).toLocaleString()}</strong>
                </div>
            `;

            if (investmentCountry !== country) {
                resultHTML += `
                    <div class="info-box">
                        <h4>â„¹ï¸ Double Taxation Treaty</h4>
                        You may be eligible for reduced withholding tax rates or tax credits under the double taxation treaty between ${investmentCountry} and ${country}. 
                        Consult a tax professional for specific advice.
                    </div>
                `;
            }

            resultHTML += `
                <div class="warning">
                    <h4>âš ï¸ Important Disclaimer</h4>
                    This is a simplified calculation for estimation purposes only. Actual tax calculations may vary based on:
                    <ul>
                        <li>Specific tax treaties between countries</li>
                        <li>Your individual tax situation</li>
                        <li>Local tax laws and exemptions</li>
                        <li>Currency conversion rates at time of transaction</li>
                        <li>Professional tax advice should be sought</li>
                    </ul>
                </div>
            `;

            resultDiv.innerHTML = resultHTML;
            resultDiv.style.display = 'block';
        }
    </script>
</body>
</html>
